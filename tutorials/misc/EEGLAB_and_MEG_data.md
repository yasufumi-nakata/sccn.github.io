---
layout: default
title: EEGLAB and MEG data
long_title: EEGLAB and MEG data
parent: Reference Topics
grand_parent: Tutorials
---
EEGLABとMEGデータ
====================

EEGLAB は、File-IO によるほとんどの MEG データのフォーマットを読み込みます。
エクステンション。 そのため、主要メーカーからのデータがインポートされる(CTF、Neuromag、Neuroimaging 4-D、BTi)。 ネイティブ *ctfimport* EEGLAB プラグインは CTF データをインポートしますが、File-IO 拡張機能を使用することをお勧めします。

ふりがな [BIDS-matlab-toolsの使い方](https://github.com/sccn/bids-matlab-tools) EEGLABプラグインは、BIDS-formated MEGデータのインポートにも対応しています。 EEGLABプラグインマネージャ(メニュー項目)からこのプラグインをインストールできます <span style="color: brown">ファイル > マネージング EEGLABエクステンション</span>). 

以下では、Neuromag MEGとCFT MEGデータをインポートしてプロットする方法を紹介します。 さらなる処理のために、EEGチュートリアルを使用する必要があります。 おすすめの使い方 [clean_rawdata(クリーンロード)](https://github.com/sccn/clean_rawdata) EEGLAB プラグインでデータをクリーンアップ(悪いチャンネルやデータが悪い部分を見つける) また、独立したコンポーネント分析(ICA)を使用して、アーティファクトを削除することをお勧めします。 残念ながら、実際のICAコンポーネントは手動でラベル付けする必要があります。 自動化された方法のような [ICラベル](https://github.com/sccn/ICLabel) そして、 [マーラ](https://irenne.github.io/artifacts/) ICAのアーティファクトが自動的にMEGデータに反映されないこと(EEGデータで訓練され、MEGデータで再訓練される必要があります)。

Neuromag MEGデータのインポート
---------------------------

例えばNeuromagデータでは、一般的な「multisubject,multimodal Face Processing」を使用します。 [データセット](https://nemar.org/dataexplorer/detail?dataset_id=ds000117)お問い合わせ データセット全体をダウンロードする代わりに、 *sub-01_ses-meg_task-facerecognition_run-01_meg.fif* を *sub-01/ses-meg/meg* フォルダにダウンロードできます。 EEGLABを起動した後、メニュー項目を選択 <span style="color: brown">ファイル > インポートデータ > File-IO インターフェイスの使用</span>お問い合わせ ファイルやフォルダをインポートしたい場合は、 ボタンを選択してファイルをインポートし、コンピュータ上のファイルを選択します。

![スクリーンショット 2022-12-22 11 47 49 PM](https://user-images.githubusercontent.com/1872705/209294989-34f958d5-6cc9-4639-9662-c96cf4217204.png)

すべてのインポートオプションをデフォルトのままにしてOKを押します。 次に、処理し、プロットしたいMEGチャネルを選択します。 メニュー項目を使用する <span style="color: brown">編集 > データの選択</span>お問い合わせ ボタンをクリックすると、チャンネルの種類をブラウズし、*megmag* を選択して、マグノメータチャンネルタイプを選択します。 OK を押し、もう一度 OK を押して、これらのチャンネルを選択し、他のチャンネルを削除します。

![スクリーンショット 2022-12-22 に 10 56 53](https://user-images.githubusercontent.com/1872705/209293499-5f5a06c4-7cf4-45a8-8d89-e323e888cddc.png)

MEGデータスペクトラムなど、単純なプロットを作ってみよう。 メニュー項目を使用する <span style="color: brown">パロット > チャネルのスペクトルおよび地図</span>お問い合わせ スペクトル電力を7および15 Hzにプロットする頻度を変えて下さい。 電極をプロットするオプションを変更することもできます。 OKを押し、次のスペクトルが表示されます。 EEGチュートリアルを参照してください。 

![スクリーンショット 2022-12-22 11 42 39 PM](https://user-images.githubusercontent.com/1872705/209294152-ee22cc89-46d5-429d-a0de-31fa31a83d37.png)

CTF MEGデータのインポート
----------------------
CTFでは、上記1つよりも、より困難なデータセットを使用します。 一部のCTFデータセットにはセンサーの位置が関連付けられていますが、必ずしもそうではありません。 ご利用にあたって [チュートリアルデータ](https://nemar.org/dataexplorer/detail?dataset_id=ds000246) Brainstormでは、サイズが小さく、ダウンロードが簡単です。 しかし、このデータセットにはセンサーの場所はありません。 

まず、データをダウンロードし、最初にデータをインポートしてみましょう。 EEGLABを起動した後、メニュー項目を選択 <span style="color: brown">ファイル > インポートデータ > File-IO インターフェイスの使用</span>お問い合わせ ファイルやフォルダをインポートするように求められます。 フォルダをインポートし、*sub-0001/meg*サブフォルダにある*サブ-0001_task-AEF_run-01_meg.ds*を選択します。 チェックボックス*データを連続データ*へ変換します。 CTFデータは実験として保存されることがあります。なぜなら、大きめでコンピューターメモリ内で処理されることはありません。 データを試用として保存することで、データを一度に1つのトライアルをロードすることができます。 これは1〜2年前に意味しましたが、ほとんどのコンピューターがデータセット全体をロードして処理できるため、この制限は廃止されます。 MEGデータ試行はしばしば関連性があります。そのため、データの試行を連続データに変換できます。 データ試用をフィルタリングすることで、そのオプションを使用することをお勧めします。 [統計力の減少](https://www.biorxiv.org/content/10.1101/2022.12.03.518987v1)お問い合わせ 完了したらOKを押して下さい。

![スクリーンショット 2022-12-23 12 26 48 PM](https://user-images.githubusercontent.com/1872705/209402761-fcce17a6-aac0-47cb-8bb6-a5b501edf7f0.png)

その後、非MEGチャンネルを削除してみましょう。 Neuromag のデータセットとは異なり、このデータセットでタイプ別にチャネルを選択することはできませんので、名前でチャンネルを選択(一部の CTF のデータセットにはチャンネルタイプがありますが、これはそのうちの 1 つではありません)。 メニュー項目を使用する <span style="color: brown">編集 > データの選択</span>お問い合わせ チャネルをブラウズし、チャネル*MLC11-4408*を*MZP01-4408*に選ぶためにボタンを押して下さい。 OK を押し、もう一度 OK を押して、これらのチャンネルを選択し、他のチャンネルを削除します。 274チャンネルで残しておく必要があります。

![スクリーンショット 2022-12-23 に 11 52 43](https://user-images.githubusercontent.com/1872705/209402624-82ab9561-a4a7-4631-8b39-da69bb81d449.png)

次にセンサーの位置を割り当てる必要があります。 そのためには、メニュー項目を呼び出します <span style="color: brown">編集 > チャネルの場所</span>*Look up locs*ボタンを押します。 2Dプロット用のレイアウトファイル*CTF275_helmet.mat*を選択します(このタイプのファイルは3Dプロットやソースローカリゼーションに使用する必要はありません)、チェックボックスを選択して、チャンネルの場所を調べる代わりにファイルをインポートします。 「-4480」の接尾辞を持つチャンネル名を除き、チャンネルの位置を調べるのは良いでしょう。 チャンネルの場所を調べるには、まずMATLABコマンドラインでpostfixを削除する必要があります。その後、EEGLABはレイアウトファイル内のチャンネルを調べることができます。 しかし、代わりにレイアウトファイルをインポートしてみましょう。 そのため、OKを押してレイアウトファイルをインポートします。

![スクリーンショット 2022-12-23 12 31 38 PM](https://user-images.githubusercontent.com/1872705/209403077-a3abcf6b-104a-43fe-aecc-7b19bf7b237c.png)

何らかの理由で、現在のデータセットはチャンネルMRT27を欠いているので、レイアウトから削除する必要があります。 また、データセットにない最後の2チャンネル、*COMNT*、*SCALE*を削除する必要があります。 チャンネル MRT27 を見つけて、 *delete* ボタンを押します。 次に、最後の2つのチャンネルを見つけて、それらを削除します。 データチャネルの数である 274 チャネルで残しておく必要があります。 274チャンネルを持っていない場合、EEGLABはインポートしたチャンネルの場所を疑って無視します(データを持つチャネルの数がチャンネルの場所に対応しなければなりません)。

![スクリーンショット 2022-12-23 12 40 57 PM](https://user-images.githubusercontent.com/1872705/209403788-6ef250ea-ff64-416f-872c-5648fd6e1bd6.png)

メニュー項目 <span style="color: brown">パロット > チャネルのスペクトルおよび地図</span> スペクトルをプロットする。 スペクトル力を10Hzにプロットする周波数を変更します。 電極をプロットするオプションを変更することもできます。 OKを押し、次のスペクトルが表示されます。

![スクリーンショット 2022-12-23 12 05 21 PM](https://user-images.githubusercontent.com/1872705/209403909-5cef619b-86db-481a-baad-f8a750f2bd25.png)

このデータでソースローカリゼーションを実行するには、センサーから3Dの場所を取得する必要があります(2Dレイアウトの代わりに)。 これらは、同じシステム(例えば、 [NIMH内外周ヘルシーなボランティアデータセット](https://openneuro.org/datasets/ds004215/versions/1.0.1) それを持っています。 [統一研究の母](https://data.donders.ru.nl/collections/di/dccn/DSC_3011020.09_236?0) データセットはそれらも持っています)。 これらのデータセットをインポートしたら、メニュー項目を使うことができます。 <span style="color: brown">編集 > データセット情報</span>、およびチャネルの場所については、ボタン *他のデータセット*から。 2つのデータセットが同じデータチャネルと同じチャネルラベルを持っていることを確認する必要があります。

EEGLABは、MEGデータを処理し、トポグラフィプロットを調整する自動検出を行います。 しかし、もしそうでなければ、手動でMATLABコマンドラインのプロット設定を変更することができます。 そのためには、タイプ:

```matlab
EEG.chaninfo.topoplot = { 'headrad' 0.3 'conv' 'on'};
eeglab redraw
```

これらのコマンドは、ヘッドのサイズを変更し、コンベックスのハブを使用して、チャンネルのプロット限界を決定します。 

MEGを使用したソースローカリゼーション
-----------------------------
EEG とは異なり、MEG のソース ローカリゼーションは通常、対象の anatomical MRI を使用します。これらは通常利用可能です。 このチュートリアルでは、我々は人気のある [Henson-Wakeman データセット](https://nemar.org/dataexplorer/detail?dataset_id=ds000117)お問い合わせ 最初の被写体から一部のファイルのみが使用可能です。 [詳しくはこちら](https://sccn.ucsd.edu/eeglab/download/ds000117_sub-01.zip)お問い合わせ 以下に示すMRIオーバーレイプロットはFieldTripです。 DIPFITはEEGLABの拡張機能で、FieldTrip機能を利用して、同等のダイポールソースモデルのローカリゼーションを実現します。 このチュートリアルは、非常に似ています [EEGを使っているもの](../09_source/Custom_head_model.md) 同じデータで。

## MRIをファイズシャルと関連付ける

メニュー項目を使用してデータをインポートする <span style="color:brown">*ファイル > インポートデータ > File-IO インターフェイスを使用する*</span>*ses-meg*フォルダ内の*sub-01_ses-meg_task-facerecognition_run-01_meg.fif*ファイルを選択します。 *sub-01_ses-meg_coordsystem.json* に保存されます。 EEGLAB は、このファイルを自動検出し、そのファイルを読み込みます。 他のデータフォーマットを使用する場合は、通常は電極の位置と定義されます。 メニュー項目を手動で追加することができます <span style="color:brown">*編集 > チャンネルの場所*</span>.

このデータセットにはEEGとMEGデータの両方が含まれているため、MEGチャネルを選択します。 メニュー項目を使用する <span style="color:brown">編集 > データの選択</span> *megplanar* チャンネルタイプをすべて選択します。

![スクリーンショット 2022-12-23 に 3 37 38](https://user-images.githubusercontent.com/1872705/209413866-4c6d647c-26da-465c-8527-db09ffc2e4ea.png)

メニュー項目の呼び出し <span style="color:brown">ツール > DIPFITを用いたソースローカリゼーション > MRIからヘッドモデルを作成する</span>お問い合わせ MRヘッドのイメージを選択し、次のGUIが表示されます。 この例では、atフォルダーからファイル名 "sub-01_ses-mri_acq-mprage_T1w.nii.gz" を使用します。

![スクリーンショット 2025-10-28 に 13 53 16](https://github.com/user-attachments/assets/95e421ef-18c1-49c1-a3fb-f32beb3e8722)

これは、まず第一弾をポップアップします。 この例では、MR ヘッドイメージと自動整列されます。 しかし、アライメントをチェックするのはいつも良いです。 私たちがそれらが期待する場所(薄い青い線が自分の位置を示す)の下の図を見ることができます。

![スクリーンショット 2022-12-11 に 3 37 03](https://user-images.githubusercontent.com/1872705/206935920-b0f5e662-8571-40af-bba3-709eed80e306.png)

それからMRIは脳、頭蓋骨および頭皮に分けられ、網は抽出されます。 MRIをセグメント化し、メッシュを作成するためにFreesurferを使用する方が良いことに注意することが重要です。それはより正確です(より時間がかかりますプロセス)。 ふりがな [pop_dipfit_headmodel.m は、](http://sccn.ucsd.edu/eeglab/locatefile.php?file=pop_dipfit_headmodel.m) "bemcp" メソッド、FieldTrip の外部モジュールを使用してメッシュを抽出します。 繰り返しますが、これは最もクロスプラットフォーム互換ソリューションですが、最高のものではないかもしれません。

![スクリーンショット 2025-10-28 に 13 54 28](https://github.com/user-attachments/assets/149060b8-ec2e-4c98-b8c6-26de5691ddd2)

これが完了したら、メニュー項目を呼び出します <span style="color:brown">ツール > DIPFITを用いたソースローカリゼーション > ヘッドモデルと設定</span>お問い合わせ ヘッドモデル、MRI、および関連する座標ランドマークがブランクアウトされていることがわかります。 グラフィックインターフェイスは、FieldTrip形式でカスタムヘッドモデルを編集していることも示しています。

![スクリーンショット 2022-12-11 7 43 48 PM](https://user-images.githubusercontent.com/1872705/206956553-435a3f9f-48db-4bff-b714-4fddc37aa3f6.png)

*Co-register*ボタンを押し、コリベーションウィンドウで、*Align fiducials*を選択し、ウィンドウでOKを押すと、チャンネルのペアを選択できます。 *具体的な図形*は堅い変形を加えます。これは私達がMRIのfiducialsおよびチャネル スペースのfiducialsがあらゆる次元(同じです)に沿って伸びるべきではないので望むものです。 coregistration ウィンドウは、スケーリングとオフセットを変更することで、手動で(右)調整できる非パーフェクトアライメント(左)を表示します。 電極は頭皮の上にあるべきです。 誤差は、関連する不確実性によるものです [フィデューシャルの選択](https://eeglab.org/tutorials/ConceptsGuide/coordinateSystem.html#eeglab-electrode-coordinate-systems). 

![スクリーンショット 2022-12-11 に 11 06 22 PM](https://user-images.githubusercontent.com/1872705/206982193-92e59b82-90b9-43c5-8e7a-d551a90d66d1.png)

'OK'を押して、共同登録グラフィックインターフェイスを閉じ、ダイポール設定グラフィックインターフェイスを閉じるために再び'OK'を押します。 現地化の準備ができました。 [ICAコンポーネントスカルププロジェクションマップ](DIPFIT.md) ・その他 [EEGソースプロジェクションマップ](EEG_sources.md).



解剖学的MRIが利用できない場合は、すべて失われません。 例えば、 [公開可能なデータセット](https://openneuro.org/datasets/ds004330/versions/1.0.0) MRIが含まれていません。 重要なのは、MEGの対象ヘッド位置でテンプレートヘッドモデルを適切に揃えることです。 これらは通常十分ではありません。 下の図形を使用して、MEGセンサーをテンプレートヘッドに合わせたり、anatomical MRIから抽出された被写体のヘッドに合わせます。 テンプレートヘッドが被写体と一致して伸びているにもかかわらず、2つの大きな違いを見ることができます(これは硬変ではありませんでした)。 言い換えれば、フィデューシャルはヘッドポジションをキャプチャしますが、ヘッドジオメトリではありません。 もしそうしたなら、被写体の頭にマッチするテンプレートのヘッドモデルを伸ばすことが期待されます。

![スクリーンショット 2022-12-23 に 2 26 26 PM](https://user-images.githubusercontent.com/1872705/209410775-d9e51fab-6bff-44fd-a05c-6506e3fcbd18.png)

これを修正し、テンプレートヘッドモデルを使用する方法は、利用可能なときにEEGチャンネルの場所を使用することです。 EEG チャネルは通常、MEG センサーと同じ座標空間でスキャンされます。そのため、MEG ヘッドモデルを揃えて、チャネル座標に合わせると、上記の問題を解決できるはずです。 *headshape.pos* ファイルが MEG と共に利用できることもあります。 被写体の頭部に横たわるデータポイントが含まれており、メグセンサー空間を解剖MRIに整列させることができる。 しかし、このファイルは、被験者の頭に合わせて、EEGLABテンプレートMEG境界要素モデルを揃えてストレッチするためにも使用できます。 このファイルを使用するには、MATLAB コマンドラインでランダムなデータ配列をスキャンした位置の同じ数で作成します。 *a=rand(150, 1000);* および MATLAB 配列としてインポートします。 その後、チャンネルエディタを呼び出して、*headshape.pos*ファイルを*SFP*ファイルとしてインポートします。 スキャンした位置をBEMヘッドモデルと整列できます。 均質な変換行列を書いて、MEGモデルアライメント用に再利用します。

MEGのテンプレートヘッドモデルを使用する
---------------------------------
被写体MRIを使うのが好ましいのですが、MEGデータでMNEヘッドモデルを使うことができます。 ヘッドモデルとセンサーのアライメントをFiducialsで行います。 EEGとMEGは同じ境界要素モデルを使用します。 MEGでは、モデルの内面のみが使用されます。 フィールドトリップでモデルフィッティングを行います。

センサーとモデルがソースのスペースを調整
----------------------------------
EEGとは異なり、モデルスペース(通常MNI)でソースローカリゼーションが行われ、センサースペースでMEGのソースローカリゼーションが行われます。 センサー空間にモデルを投影することを意味します。 練習では、EEG。 dipfit構造は、モデルスペースの代わりにセンサーのソースが含まれています。 この選択肢の理由は、FieldTrip が MEG データを扱う方法です。 

MEGパイプライン
------------
実践的なMEEGワークショップのMEGパイプラインを実証しました。 パイプラインのコードは利用可能です [詳しくはこちら](https://github.com/sccn/practical_MEEG)お問い合わせ ソースのローカリゼーションを含むすべてのスクリプトでは、ユーザーはEEGとMEGデータを使用しての間で切り替えることができます。

その他のMEGリソース
--------------------
EEGLABのMEGソースローカリゼーションは、フィールドトリップ機能を活用しています。 FieldTrip で設計されたヘッドモデルは、EEGLAB のソースローカリゼーションに使用できます。 MATLAB のコマンドラインから EEGLAB と一緒に使用できる MATLAB ベースの MEG ソフトウェアツールをチェックしてください。

-   <http://www.nitrc.org/projects/fieldtrip>
-   <http://www.nitrc.org/projects/cuda_sphere_fwd>
-   <http://www.nitrc.org/projects/bst>
-   <http://www.nitrc.org/projects/openmeeg>
-   <http://www.nitrc.org/projects/meg-tools>
-   <http://www.nitrc.org/projects/megsim>
