---
layout: default
title: a. Head model
long_title: a. Head model settings
parent: 9. Source analysis
grand_parent: Tutorials
---


<details open markdown="block">
  <summary>
    コンテンツの表
  </summary>
  お問い合わせ
- トピックス
お問い合わせ
</details>

# 基本に戻る

ソースのローカリゼーションを実行するには、1つのニーズ

1. A **ヘッド モデル** ヘッドを通る電気または磁場の伝搬方法を説明する
     * 異なる導電率を持つ球で作られたシンプルなモデルかもしれません
     * 皮質の表面、頭皮、皮を記述する幾何学的3次元の網から成っているより複雑なモデル、またこれらの表面のインターフェイスの伝導の変化であるかもしれません。
     * ボリュームトリカルなモデル(Finite Element Model、FEM)は、各バクセルの電流の流れを記述することができます。 FEMモデルは、理論的には、より正確です。しかし、彼らは計算に時間がかかる。
2. A **ソースモデル** これらのフィールドを生成するソースの位置を記述する
     * シングルダイポールになる場合があります。 
     * 3Dグリッド(例えば、分散ソースのローカリゼーションのためのボリュームトリカルなソースモデルなど)で配布されるダイポールかもしれません。 [eロレタ](https://doi.org/10.1098/rsta.2011.0081)).
     * 表面に分散するダイポールがあるかもしれません。 例えば、異方性面にあるダイポールを強制する場合があります。
3. EEGまたはMEG **センサー位置**とヘッドモデルとソースモデルの両方でそれらを整列する方法

3つすべてを持っていると、ソースのアクティビティを見つけるためのアルゴリズムが必要です。 残念ながら、スキャルプの表面で観察されたアクティビティを生成できる無限のソリューションがありますので、ソースの制約を課す必要があります。 制約は次のようになります。

* 単一のダイポールでスカルプ活動をモデル化させる力。 この方法では、通常、ユニークな最適なソリューションがあります。
* 電源を円滑にするため、隣接するソースの活性が相関しています。 これは eLoreta ソリューションです。
* 隣接するソースの活動を線形に制約された最低の分散(LCMV)を使用して無関係であるように強制して下さい [ビームフォーミング](https://doi.org/10.1109/10.623056).
* 私たちのソースの活動に対する他の制約...

以下の図は、上記の手順を説明します。 電極、ヘッドモデル、ソースモデルを揃えた後、EEGデータをソース再構築アルゴリズム(単一ダイポール、eLoreta、ビームフォーミングなど)に提供します。 電極の位置、ヘッドモデル、ソースモデルに基づいて、多くの場合、トランスフォーメーションマトリックスが計算されます。 この行列は、特定のソース(ソースモデルで記述)が個々のEEGチャネルの活動を影響する方法を示します。 そのサイズは*source x EEGチャンネル*で、**Leadfield行列**と呼ばれます。 この行列があれば、電極の位置、ヘッドモデル、ソースモデルを無視できます。 同じリードフィールド行列は、単一のダイポール、eLoreta、およびビームフォーミングソース再構成に使用できます。

![](https://user-images.githubusercontent.com/1872705/206873268-edbf713f-962d-4e74-a608-e915b3441b84.png)

# ヘッドモデルの選択

ソースローカリゼーションの最初のステップは、導電性の異なる領域を定義するヘッドモデルを選択します。 このセクションでは、EEGLABのヘッドモデルを選択し、電極の位置でヘッドモデルを揃える手順を説明します。 他の手順は、チュートリアルの次のセクションで記述されています。
<!-- Second, choosing a source model: The source model is the type of source you will use. This may be a single dipole, which position you optimize. This could also be  -->
<!-- a distributed model, with one dipole per brain voxel, such as when using Loreta. The source model is independent of the head model. Third, you will perform inverse source localization and plot the source results. -->

## DIPFITヘッドモデルの設定

このセクションでは、後にチュートリアルデータセットを使用します。 [データエポック抽出](/tutorials/07_Extract_epochs/Extracting_Data_Epochs.html)お問い合わせ メニュー項目を選択 <span style="color: brown">ファイル</span> サブメニュー項目を押します
<span style="color: brown">既存のデータセットをロードする</span>お問い合わせ EEGLABの「sample_data」フォルダにある「eeglab_data_epochs_ica.set」のチュートリアルファイルを選択します。 それから *Open*を押して下さい。

DIPFITは、チャネルレベルの信号を1つ(または2つ)単一のソースに1つ(または2つ)1つに分類する単一(またはカップル)ダイポールフィッティングアルゴリズムです。 EEGLABは、DIPFITを主流のローカリゼーションアルゴリズムとして導入しましたが、EEGLAB内でのビームフォーミングやeLoretaのサポートも行っています。 ここでは、ヘッドモデルを選択し、ヘッドモデルで電極の位置を合わせるDIPFIT GUIを使用しています。

DIPFITヘッドモデルのシーティングにアクセスするには、EEGLABメニュー項目を選択します。 <span style="color: brown"> ツール → DIPFIT → ヘッドモデルと設定を使用したソースローカリゼーション</span>お問い合わせ 以下のウィンドウが表示されます。

![](../../assets/images/dipfit_settings_besa.png)

上部の編集箱、*モデル(選択するためにかちりと言う音)*は、頭部のタイプを指定します
モデル -- 球面モデル、テンプレート境界要素モデル(BEM)、またはカスタムモデル。 

※4面(皮、頭皮、CSF、皮質)を4面に使用
ヘッドをモデル化します。 球面ヘッドモデルは後方互換性の目的のために保持され、出版物に使用するべきではありません。 球面モデルはBESAソフトウェアのバージョンに対してテストされ、同様の結果を詳細に返すために示されています [詳しくはこちら](https://github.com/sccn/sccn.github.io/files/10201215/DIPFIT.vs.BESA.study.using.the.spherical.head.model.pdf).

**template 境界要素モデル** は、MNI (Montreal Neurological Institute) の正式なテンプレートの脳から抽出された 3 D 表面 (皮、頭皮、皮質) から構成されています。 BEMモデルは4つの同心球モデルより現実的であり、より正確な結果を返します。 BEMモデルの生成方法の説明が利用可能 [詳しくはこちら](https://pubmed.ncbi.nlm.nih.gov/11222970/)お問い合わせ DIPFITで最初に使用していたが、この標準のBEMモデルは、*ft_read_headmodel('standard_bem.mat');*を入力すると、FieldTripのモデルと同じです。 オリジナルのBEMヘッドモデルの作者として [ペーパー](https://pubmed.ncbi.nlm.nih.gov/11222970/) 「このテンプレートは、単一の代表的な主題の高品質の分析MRIから構成され、1 x 1 x 1 mmのvoxelサイズで、モントリオール神経科学研究所のMcConnell Brain Imaging Centreによって作成されます。 27 T1級のスキャンをステレオタクティックスペースで登録することで作成され、サブサンプリングされ、強度が平均化しました。 この平均化されたMRIの生成後、各Voxelの組織タイプを識別するために、エキスパートガイド付きセミオートセグメンテーションが行われました。 MRシミュレータを用いた脳のノイズレスMRIの構造に平均脳のこのセグメンテーションが使われました。 このノイズレスMRIは、結果の視覚化のために、この紙で使用されます。元のMRIのセグメンテーションは、頭の実際の形状の容積伝導モデルを作成するために使用されます。 この特定のMRIを使用する動機は、統計的なパラメトリックマッピングパッケージ(SPM、1999)のテンプレートの脳を形成していたことです。

FieldTrip**の**カスタムモデルとMRIファイルにより、ユーザーはFieldTripで設計されたカスタムヘッドモデルを利用することができます。 被写体 MRI から BEM ヘッドモデルを作成する指示は記述されます [詳しくはこちら](https://www.fieldtriptoolbox.org/tutorial/headmodel_eeg_bem/)お問い合わせ モデルを作成したら、電極アライメントはEEGLABで実行されるので、電極アライメントに関するFieldTripチュートリアルの2番目の部分はスキップされます。

この例では、*Boundary 要素モデル*を選択します。 モデル名をクリックすると、ドロップダウンメニューのフィールドが更新されます。

* エントリー *ヘッドモデルファイル*にはヘッドモデルパラメータ(表面情報、導電性など)が含まれています。 これらはMATLABファイルであり、編集される可能性があります。 ヘッドモデルファイルの詳細については、FieldTrip のドキュメントを参照してください。 
* 編集ボックス *Matrix は、ヘッドモデルでチャンネルの位置を揃える* が自動的に更新され、現在のヘッドモデルと並列する。 ランドマーク電極の位置でMNI平均脳MRIを共同登録しました。 平均的なMRIイメージでは、MNIデータベース(Montreal Neurological Institute(MNI)、ケベック)のMNIデータベース(Montreal Neurological Institute(MNI)から利用できる、152 T1級のステレオ戦術的なボリュームの平均的な脳画像(平均)を使用しました。 MNI 脳と標準 EEG ランドマークの共同登録は、ファイズルと Cz (vertex) 電極の位置を使用して自動的に達成され、手動で調整されます。 テンプレートのチャンネルの場所は理想的ではなく、ヘッドモデルと互換性のある実際の電極の位置を使用する方が良いでしょう(次のセクションを参照してください)。 トランスフォーメーションマトリクスの自動更新は、常に実行されず、後で説明するように、電極座標とヘッドモデルを手動で整列する必要がある場合があります。
* エントリ * 関連する MRI ファイルをプロットする* には、MRI のイメージの名前が含まれています。 このファイルが最初にMNI脳に正規化されていると仮定して、カスタムまたは個々のMR画像ファイルを入力することができます。 ふりがな [SPMソフトウェア](https://www.fil.ion.ucl.ac.uk/spm/) MNI脳のテンプレートに入力して正規化として生の主題MRIをとります。
* エントリ * 関連するチャンネルの場所 * 任意の * は、ヘッドモデルに関連付けられているテンプレートチャンネル位置ファイルの名前が含まれています。 この情報は、データセットのチャンネルの場所ファイルがテンプレートとは異なる可能性があるため、重要です。 もしそうなら、モデルに関連付けられているテンプレートの場所を使用してチャンネルの位置を合わせるには、共同登録変換が必要です。
* ダイポールフィッティング*からチャンネルを省略するチャンネルを編集する*。 "*...*" を押すと、チャンネルのリストが表示されるので、ユーザーはダイポールフィッティング手順からアイチャネル(または他の、おそらく非ヘッドチャネル)を除外することができます。 例えば、ダイポールフィッティングを実行する前に、ノンスカルプチャネルを削除する必要があります。 頭の前面での導電性モデルの悪い形状のため、逆のソースモデルからperi-ocularチャンネル値を排除することをお勧めします。

## ヘッドモデルと電極の位置の調整

次は、電極の位置をヘッドモデルと整列するコリギスです。 従来の「**digitized**」の電極の位置に基づいて、各個々の電極の位置を持っている場合は、調整が若干異なります。 ここでは、まず「**template**」電極の位置の共同登録プロセスについて説明します。

<!-- ### The default headmodels

The first default head model for FieldTrip is a spherical head model. This is the  -->

### 適切な *template* チャネルの場所の選択による共同登録

チャネルの場所がヘッド モデルに関連付けられているものと同じである場合、それは理想的です。 ここではデータセットでは、BEM ヘッドモデルを使いたい時に、チャンネルの位置は球面座標系にあります。 すべての電極の位置が国際10-20システム(この場合です)内にある場合、ヘッドモデルに関連付けられている標準チャンネル座標を使用する場合があります。 現在のヘッドモデル設定ウィンドウを閉じ、チャンネル編集ウィンドウに移動します
(メニュー項目を選択) <span style="color: brown">編集 → チャンネルの場所</span>)。 結果のチャンネルエディタウィンドウは以下のとおりです。

![600px\|ボーダー](../../assets/images/Dipfit_pop_chanedit2.png)

*Look up locs* を押して、テンプレートのチャンネル位置ファイルでチャンネルの位置(チャンネルラベルのマッチング)を調べます。 ※BEM DIPFITモデルのMNI座標ファイルを使用してください。

![](../../assets/images/chanlocs_bem.png)

上記のウィンドウとチャンネルエディタウィンドウで *Ok* を押します。 その後、ヘッドモデルの設定に戻ります <span style="color: brown"> ツール → DIPFIT → ヘッドモデルと設定を使用したソースローカリゼーション</span> メニュー項目。 下のウィンドウがポップアップ表示されます。 電極の座標をヘッドモデル(edit box *Matrix)に整列する行列が確認できます。ヘッドモデル*を主として位置します。同軸平面の90度回転に対応する -pi/2 (-1.5708) が主に含まれています。 EEGLABは、ヘッドモデルが異なる慣習を使用している間、鼻の方向が特定の軸に沿っていると仮定しているためです。 Talairach変換行列、9つのフィールド*\[shiftxshiftyshiftzピッチロールyaw scalex scaley scalez\]*で構成されたベクトルは、次のように編成されます。

* 最初の3つの数字*\[shiftxshiftyshiftz\]*は、x、y、z軸に沿ってオフセット(ミリメートル)です。 0に等しい場合、シフトは適用されません。
* 次の3つの数字 *\[pitch Roll yaw\]*は、ラジアンの異なる平面に沿って回転します。 *Yaw*はz軸周りの水平平面の回転を意味します。 *Pitch* と *Roll* はそれぞれ x と y 軸の周りの回転です。 0に等しい場合、回転は適用されません。
* 最後の 3 数字 *\[scalex scaley scalez\]* は x, y, z 軸に沿ってスケーリングする要因です。 1に等しい場合、スケーリングは適用されません。

この場合は、電極座標とヘッドモデルの座標系の間の90度回転のみのアライメントが必要です。 共同登録・整列が不要の場合、*コアグなし*チェックボックスを選択することもできます。

![](../../assets/images/dipfit_settings_bem.png)

*注意事項:* チャンネルの場所を変更する場合は、必ずDIPFIT設定に戻り、座標変換の設定を更新してください。

### *template* チャネルの場所の手動調整

チャネルの場所および/またはラベルを使用している場合は、国際10-20システム内の*not* - たとえば、商用の高密度電極キャップファイル - 選択したヘッドモデルで電極の位置を揃えまたは共同登録する必要があります。 調整インターフェイスは、電極の位置をヘッドモデルに自動的に整列することができません。 代わりに、電極の位置を自動的に整列して、ヘッドモデルに関連付けられているテンプレート電極の位置をマッチングすることができます。

繰り返します。 <span style="color: brown"> ツール → DIPFIT → ヘッドモデルと設定を使用したソースローカリゼーション</span> メニュー項目。 DIPFIT設定画面の*Co-register*をクリックします。 ウィンドウが表示されます。 *resize* 値が 1.5 に変化し、すべての軸が電極を見るようにします(照合目的のアライメントを解除します)。

![](../../assets/images/coregister_new1.png)

ここでは、ヘッドモデルに電極の位置をプロットします。 各小さな赤または緑色の球は、電極の場所を示しています。, 表面的な場所 (conventionally, nasion and pre-auriculars) わずかに大きく、暗い球として描画.

*Warp*ボタンを使用して、電極の位置(緑色)を整列し、ヘッドモデルに関連付けられているテンプレートの電極位置(茶色)に最も適したようにします。

チャンネル対応ウィンドウがポップアップ表示されます。

![画像:Pop_chancoresp.gif](../../assets/images/Pop_chancoresp.gif)

データセット電極構造のチャンネルラベルは右列に表示され、左列はヘッドモデルに関連付けられているテンプレートチャンネルファイルからチャンネルラベルを表示します。 両方の列の矢印は、他の列の同じラベルを持つ電極を示しています。 チャンネルのラベルがテンプレートモンタージュで使用される国際10-20システムラベルに対応していない場合は、*Pairチャンネル*ボタンを押し、テンプレートモンタージュの各データセットチャネルに最も近いチャンネルを選択します。

*Ok*を押すと、ヘッドモデルに関連付けられているテンプレートのモンタージュにチャンネルモンタージュを合わせるために、最適なリニア3Dワープ(変換、回転、スケーリング)を実行します。 結果はチャンネルモンタージュウィンドウ(以下参照)に表示されます。 *Labels on*ボタンを押して、チャンネルのラベル(緑色)またはヘッドモデル(赤)に関連するテンプレートチャンネルの表示を切り替えることができます。 *Electrodes*ボタンを使ってチャンネルのサブセットに表示を制限することもできます。

<u>手動微調整:</u> 手動でアライメントを細かく調整するには、*\[shiftxshiftyshiftz ピッチロール yaw scalex scaley scalez\]* に対応する編集ボックスの値を繰り返し編集します。 結果の共同登録ウィンドウはこのようになります。

![画像:coregister_new2.png](../../assets/images/coregister_new2.png)

変更を保持したい場合は、*Ok*を押してDIPFIT設定画面を更新します。 これにより、生成されたTalairach変換行列を編集ボックス*Matrixに表示し、チャンを整列します。 ヘッドモデル*で移動します。 この特定のケースでは、さらなるアライメントが不要になったため、共同登録インターフェースの*Cancel*ボタンを押下することができます(さらなるアライメントを必要としなかったデータセットのイラストの共同登録を行いました)。 その後、DIPFIT設定ウィンドウで*Ok*を押して、チュートリアルの次のセクションでローカリゼーションに進みます。

<u>財務情報:</u> チャンネル構造には、標準の局所(nasionとpre-auricular point)が含まれる場合があります。 チャンネル ファイルをチャンネル エディターに忠実な場所にインポートすると、標準の *fiducial* チャンネル タイプ *FID* を指定し、チャンネル情報構造、 *EEG.chaninfo* に保存されます。 *Nz*(nasion)、*LPA*(左前方点)、*RPA*(右前方点)の基準名が記載されている場合、自動的に行います。 ファイズルについてのかなりの混乱があり、新しいファイズラルラベルを作成しました
密接な正確な場所(これを参照してください) [スライド](https://sccn.ucsd.edu/eeglab/download/Fiducials.pdf))。 *EEG.chanlocs*は、他のEEGLABのプロット機能との互換性のために、通常のチャンネル位置構造の外部に保存されます。

その後、チャンネルの共同登録ウィンドウ(above)に忠実な場所が現れ、ヘッドモデルに関連付けられているテンプレートの場所に電極のモンタージュを合わせるために(位置一致したスカルプチャネルの代わりに)使用することができます。 *Align fiducials*ボタンを使用してこれを行います。

### *digitized*電極の位置の調整

個別化された電極の位置は、ソースのローカリゼーション精度を大幅に向上させます [40%以上](https://doi.org/10.3389/fnins.2019.01159), 精度が正しいブロドマン領域の皮質活性を定量化すると定義されるとき. 各々の電極の位置を使用して、3Dデジタル化方法が必要です。 伝統的に、 [ポリヘムス](https://polhemus.com/scanning-digitizing/digitizing-products/) そして、 [ゼブリス](https://www.zebris.de/en/) 電極の相対的な3D位置を図表から提供するために使用されるシステム。 赤外線3Dスキャナへのアクセスが豊富で、スマートフォンの顔のロック解除カメラを含む3Dスキャナは、ミリメートルの精度を持つ3Dスキャンをヘッドから得ることができます。 スキャンは対象の時間から5分かかります。EEGLABなどの利用可能なツールボックスを使用して、デジタル化を実行できます。 [get_chanlocs ディレクティブ](https://github.com/sccn/get_chanlocs/wiki)お問い合わせ スキャン用のスマートフォンを使用して、電極のデジタル化のための最も手頃な価格の方法です。また、ソフトウェアアプリケーションを購入するために50ドルの投資が必要であり、3Dプリントは簡単にスキャンするためのコントラプションをプリントします。 スマートフォンベースの3Dスキャナの詳細なチュートリアルをすぐに提供いたします。 [get_chanlocs ディレクティブ](https://github.com/sccn/get_chanlocs/wiki) wikiページ。

各個々の電極の場所は、多くの場合、保存されます `.sfp` EEGLABに簡単にインポートできるファイル `pop_chanedit` 機能、または選択によってGUIから <span style="color: brown">編集 → チャンネルの場所</span> *Read Location*ボタンを選択します。 その後、シミリアのアプローチ [手動調整プロセス](#manual-co-registration-of-the-template-channel-locations) 上記は、**Align fiducials**オプションを使用してのみ**で実行する必要があります。 モンタージュを警戒すると、デジタイズされた電極の場所内の任意の主観性を削除し、テンプレートの電極の場所に合わせて場所を強制することに注意してください。

## ヘッドモデルとカスタムMRI

次にダイポールソースをプロットするとき [チュートリアルのセクション](/tutorials/09_source/DIPFIT.html)ヘッドモデルヘッド面とMRIをプロットできます。 

![画像:model_align.png](../../assets/images/head_mesh.png)

この場合、前のセクションで説明するチュートリアルデータと標準BEMモデルを使用しています。 BEMヘッドモデルメッシュは、プロットに使用される平均MRIから抽出されたため、アライメントは完璧です。 参加者のMRIを使ってMNI空間に変身させる(例えばSPMを使う)と、MRIとヘッドモデル間のアライメントを確認できます。 

参加者のMRIから抽出物3次元メッシュを計算し、これを記述したようにヘッドモデルを作成することも可能です。 [FieldTripチュートリアル](http://www.fieldtriptoolbox.org/workshop/baci2017/forwardproblem/)お問い合わせ カスタムヘッドモデルをお持ちの場合は、ヘッドモデルの設定で、他のテンプレートまたは個々のサブジェクト*からドロップダウンメニュー*カスタムモデルファイルを使用します。 MEG用のカスタムヘッドモデルも、チュートリアルの次のセクションで記述できます。
